<svelte:options accessors={true} />

<script>import { afterUpdate, createEventDispatcher, onDestroy, onMount } from "svelte";
import { tsParticles } from "@tsparticles/engine";
import { initialized } from "./utils.js";
let cssClass = "";
export { cssClass as class };
let canStart = false;
let style = "";
export { style };
export let options = {};
export let url = "";
export let id = "tsparticles";
const dispatch = createEventDispatcher(), particlesLoadedEvent = "particlesLoaded";
let oldId = id;
function destroyOldContainer() {
  if (oldId) {
    const oldContainer = tsParticles.dom().find((c) => c.id.toString() === oldId);
    if (oldContainer) {
      oldContainer.destroy();
    }
  }
}
const unsub = initialized.subscribe((value) => {
  canStart = value;
  loadParticles();
});
onDestroy(() => {
  unsub();
  destroyOldContainer();
});
onMount(() => {
  void loadParticles();
});
async function loadParticles() {
  destroyOldContainer();
  if (!canStart) {
    return;
  }
  if (id) {
    const cb = (container2) => {
      dispatch(particlesLoadedEvent, {
        particles: container2
      });
      oldId = id;
    };
    const container = await tsParticles.load({
      id,
      options,
      url
    });
    cb(container);
  } else {
    dispatch(particlesLoadedEvent, {
      particles: void 0
    });
  }
}
afterUpdate(async () => {
  await loadParticles();
});
</script>

<div {id} class={cssClass} {style} />
